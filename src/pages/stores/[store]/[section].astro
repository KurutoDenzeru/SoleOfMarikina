---
import "@/styles/global.css";
import { Facebook, Instagram } from "lucide-react";
import MobileTopNavbar from "@/components/MobileTopNavbar.astro";
import StoreDetailCards from "@/components/StoreDetailCards.astro";
import { stores, storeSections } from "@/lib/store-pages";

export async function getStaticPaths() {
  const storeMap = new Map(stores.map((store) => [store.slug, store]));

  return storeSections
    .filter(
      (entry) =>
        !(
          entry.storeSlug === "nico-angelo" &&
          (entry.sectionSlug === "walk-with-them" ||
            entry.sectionSlug === "their-products")
        )
    )
    .filter((entry) => storeMap.has(entry.storeSlug))
    .map((entry) => ({
      params: {
        store: entry.storeSlug,
        section: entry.sectionSlug,
      },
      props: {
        store: storeMap.get(entry.storeSlug),
        section: entry,
      },
    }));
}

const { store, section } = Astro.props as {
  store: (typeof stores)[number];
  section: (typeof storeSections)[number];
};

const isWalkPage = section.sectionSlug === "walk-with-them";
const storyHref = `/stores/${store.slug}/souls-behind-the-soles`;
const storeMapBackgrounds: Record<(typeof stores)[number]["slug"], string> = {
  "nico-angelo": "/map/nico%20angelo.png",
  "seacrest": "/map/seacrest.png",
  "brads-trendies": "/map/brads.png",
};
const storeBackgroundImage = storeMapBackgrounds[store.slug] ?? "/map/marikina.png";
const logoClass = [
  "h-16 w-auto max-w-xs object-contain sm:h-16",
  store.logoInvert ? "invert" : "",
]
  .filter(Boolean)
  .join(" ");
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{store.name} | {section.title}</title>
  </head>
  <body>
    <section
      class="relative min-h-screen w-full overflow-hidden bg-[#d8ae73] bg-cover bg-top bg-no-repeat sm:bg-center"
      style={`background-image:url('${storeBackgroundImage}');`}
    >

      <MobileTopNavbar
        leftAction={{
          type: "link",
          icon: "move-left",
          ariaLabel: "Back to homepage",
          href: "/",
          className: "rounded-md",
        }}
        rightAction={{
          type: "button",
          icon: "search",
          ariaLabel: "Search store content",
          className: "rounded-md",
        }}
        centerImageSrc={store.logo}
        centerImageAlt={store.name}
        centerImageClass={logoClass}
      />

      {
        isWalkPage ? (
          <main class="relative z-20 px-6 pb-20 sm:px-8">
            <div class="mt-8 grid grid-cols-[auto_1fr_auto] items-center gap-4 text-black">
              <p class="max-w-[10ch] text-4xl leading-none font-bold">{store.contactName}</p>
              <div class="h-0.5 w-full bg-black/75"></div>
              <p class="text-5xl leading-none font-bold">{store.city}</p>
            </div>

            <h1 class="mt-12 text-center text-7xl leading-none font-extrabold text-white">
              {store.heroTitle}
            </h1>

            <p class="mx-auto mt-10 max-w-4xl text-center text-3xl leading-relaxed font-medium text-white">
              {section.body}
            </p>

            <div class="mt-24 text-white">
              <h2 class="text-6xl leading-none font-black uppercase">{section.title}</h2>

              <div class="mt-8 grid gap-8 text-2xl sm:grid-cols-2">
                <div>
                  <p class="text-xl font-extrabold uppercase">Contact</p>
                  <p class="mt-3 text-2xl font-medium">{store.phone}</p>
                  <p class="mt-2 text-2xl font-medium">{store.email}</p>
                  <div class="mt-5 flex items-center gap-4">
                    <a
                      href={store.facebook}
                      aria-label="Facebook"
                      class="inline-flex size-12 items-center justify-center rounded-full bg-white/15 text-white transition hover:bg-white/25"
                    >
                      <Facebook className="size-7" />
                    </a>
                    <a
                      href={store.instagram}
                      aria-label="Instagram"
                      class="inline-flex size-12 items-center justify-center rounded-full bg-white/15 text-white transition hover:bg-white/25"
                    >
                      <Instagram className="size-7" />
                    </a>
                  </div>
                </div>
                <div>
                  <p class="text-xl font-extrabold uppercase">Location</p>
                  <p class="mt-3 text-2xl font-medium">{store.location}</p>
                </div>
              </div>

              <a
                href={storyHref}
                class="mx-auto mt-14 inline-flex min-w-56 items-center justify-center rounded-full bg-black/70 px-10 py-4 text-4xl font-semibold text-white transition hover:bg-black/80"
              >
                {store.ctaLabel}
              </a>
            </div>
          </main>
        ) : (
          <main class="relative z-20 px-6 pb-16 pt-6 sm:px-8">
            <p class="mx-auto mt-8 max-w-5xl text-center text-sm leading-relaxed font-semibold text-black">
              {section.body}
            </p>
            <StoreDetailCards mode="list" cards={section.cards} className="mt-8" />
          </main>
        )
      }
    </section>
  </body>
</html>
